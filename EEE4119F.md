# Lecture 1:Numerical Integration
- Initial condition is crucial:
## Euler Method
### Euler Algorithm
- We generally want to take small increments (∆𝑡), so:
$$
y_n = y_{n-1} + \frac{dy}{dt}\Bigr\rvert_{t = 0}\Delta t
$$
## Taylor Series
- Consider an arbitrary function (y)
- We can make an approximation:
$$
\hat{y} = a +bt +ct^2 + dt^3 + ...
$$
- Solve for coefficients
- Simplest approximation would be to use derivative:
$$
\hat{y} = y(t=0) + \frac{dy}{dt}\Bigr\rvert_{t = 0}t
$$
- We can make this better with second derivative:
$$\text{put formula on page 16 of lecture 1 slides}$$
- Add more derivatives:
$$\text{formula on page 16 of lecture 1 slides}$$
- Called Taylor Series
### Error Analysis
- Initial value problem:
Euler method
Error term
- Only need to care about first term
- Why?
- Error scales with ∆𝒕
- If we half ∆𝒕 , then we half the error!
Euler Error
## Midpoint Method Error
- Extrapolation based on midpoint gradient:
- Exactly Taylor approximation of y for first three terms
	- Much more accurate than Euler!
- Let’s use Euler:
$$y_{N+\frac{1}{2}} = y_N + \frac{\Delta t}{2}\frac{dy}{dt}\Bigr\rvert_{N}$$
- Then using $y_{N+\frac{1}{2}}$ and $\frac{\Delta{t}}{2}$ , can calculate the derivative
- Last step in algorithm is then:
$$
y_{N+1} = y_N + \Delta{t}\frac{dy}{dt}\Bigr\rvert_{N+\frac{1}{2}}
$$
### Midpoint Method Steps
- `Step1: Euler`   $y_{N+\frac{1}{2}} = y_N + \frac{\Delta t}{2}\frac{dy}{dt}\Bigr\rvert_{N}$
- `Step2: Deriv`   $\frac{dy}{dt}\Bigr\rvert_{N+\frac{1}{2}}$
- `Step3: Shoot to end`: $y_{N+1} = y_N + \Delta{t}\frac{dy}{dt}\Bigr\rvert_{N+\frac{1}{2}}$
## Runge-Kutta Method
- Instead of shooting to midpoint, shoot to 4 specific points
- RK4 Algorithm
Assume: $\frac{d{y}}{d{t}} = f(y,t)$
Then:
$$
\begin{align*}
k_1 &= \Delta{t}f\left ( y_N, t_N \right )\\
k_2 &= \Delta{t}f\left ( y_N + \frac{k_1}{2}, t_N + \frac{\Delta{t}}{2} \right )\\
k_3 &= \Delta{t}f\left ( y_N + \frac{k_2}{2}, t_N + \frac{\Delta{t}}{2} \right )\\
k_4 &= \Delta{t}f\left ( y_N + k_3, t_N + \Delta{t} \right )\\
y_{N+1} &= y_N + \frac{1}{6} \left ( k_1 +2k_2 +2k_3 +k4 \right )
\end{align*}
$$
# Lecture 2:Lagrange Mechanics I
- Consider 𝑵 particles
	- Can describe configuration as: $p_N = [x_N y_N z_N]^T$
- Most times, there are constraints…
- Can then describe configuration using less parameters (𝑛 ≤ 3𝑁)
- DOF = n - m
	- 𝑚 is number of constraint equations
## Kinetic Energy
- Total Kinetic Energy of system (𝑇)
- For point particles:
$$
T = \frac{1}{2}\sum_{i=1}^{N}m_i\dot{r}_i^{2}
$$
- What about rigid bodies?
	- Include rotational energy & inertias
$$
T = \frac{1}{2}\sum_{i=1}^{N}m_i\dot{r}_i^{2} + \frac{1}{2}\sum_{i=1}^N I\omega_i^2
$$
## Potential Energy
- Potential Energy from Gravity ($V_{grav}$)
$$V = \sum_{i=1}^{N}m_igh_i$$
- Potential Energy from springs ($V_s$)
$$V = \frac{1}{2}\sum_{i=1}^{N}k_ix_i^{2}$$
## The Lagrangian
$$
L(q,\dot{q}) = T(q,\dot{q}) - V(q)
$$
### Dynamic equation for coordinate $q_i$
$$
\frac{d}{dt}\left ( \frac{\partial L}{\partial \dot{q_i}} \right ) - \frac{\partial L}{\partial {q_i}} = 0
$$
- Repeat for all 𝑖
- The above gives the EOM for the body
# Lecture 3: Lagrange Mechanics II
- Multibody Systems
## Constraints Revisited
$$\text{DOF} = 3N - m$$
- 𝑵 is number of bodies and 𝒎 is number of constraints
## Multibody systems
- Multibody systems involve multiple rigid bodies
- Each with own COM
- In Lagrange, don’t care about reaction forces or constraint equations
-  Just need to define energy of COM
## Manipulator Equation
- Lagrange EOM are straightforward but tedious to calculate
- Quick side note on motors
$$\frac{d}{dt}\left ( \frac{\partial L}{\partial \dot{q_i}}  \right ) - \frac{\partial L}{\partial q_i} = \tau_i$$
Manipulator Equation
$$
M(q)\ddot{q} + C(q,\dot{q}) + G(q) = \tau
$$
- M = 𝒏 × 𝒏 Mass Matrix
- C = velocity-product matrix
- G = Gravity term
- $\tau$ = Joint torques

# Lecture 4:3D Kinematics
## Rotating Axes
- consider vector p
- In axes 0 
$$p^0 = \begin{bmatrix}   p_x^0\\   p_y^0   \end{bmatrix}$$
- In axes 1 (rotated by $\psi$) (CCW)
$$
p^0 = \begin{bmatrix}   p_x^1\\   p_y^1   \end{bmatrix}
$$
### Changing axes
$$
\begin{align*}
p^1 &= R_0^1p^0\\
R_0^1 &= \left [ R_1^0 \right ]^{-1}\\
R_0^1 &= \left [ R_1^0 \right ]^{T}
\end{align*}
$$
- Because R is othorgonal you can just take the transpose
## Successive Rotations
Any rigid body attitude can be represented by three rotations. Eg:
### $$R_{x^2,\phi}R_{y^1,\theta}R_{z^0,\psi}$$
- Things to take note of:
	- Rotation is about the new axes
	- Rotation order starts from the right
- Resultant matrix called:
	- Direction Cosine Matrix (DCM)
## Euler Angles
- Euler angles represent attitude about using three numbers:$\textbf{u} = [\phi \hspace{5mm}\theta \hspace{5mm}\psi]^T$
- Need to specify the order
	- Eg. Euler 3-2-1 is
	- Rot about Z, then Y and the X
## Angular Velocity
- Can only add angular velocity vectors in same axis!
- Cannot directly add Euler angle rates ($\dot{\textbf{u}}$) to get $\omega_{Total}$
- We want (inertial): $\omega_T^I = E\dot{u}$
- Or (Body):$\omega_T^B = E'\dot{u}$
## Euler Rates Matrix (E)
- Eg: If we use Euler 3-2-1, E is given by: 
$$
E_{321} = \left [ [R_Z]^T[R_Y]^T\hat{e}_X, [R_Z]^T\hat{e}_Y, \hat{Z} \right ]
$$
- Total angular velocity in Inertial Frame:
$$
\omega_T^I =E\begin{bmatrix}
\dot{\phi} \\
\dot{\theta} \\
\dot{\psi}
\end{bmatrix}
$$
# Lecture 4:
3D Dynamics
• Kinetic Energy
• Potential Energy
Overview
ABB Robot Arms
Mini Cheetah
Exercise: Two Axis Gimbalx0
y0
z0
φ
θ
x1
y1
z1
Rotation order:
1. Rotation about X
2. Rotation about Y
Task
• Derive DCM (𝑹𝟎
𝟏)
• Derive Euler Rate Matrix
Exercise: Two Axis Gimbalx0
y0
z0
φ
θ
x1
y1
z1
*Assume origin of all axes aligned
𝑅0
1 =
𝑐𝑜𝑠𝜃 0 −𝑠𝑖𝑛𝜃
0 1 0
𝑠𝑖𝑛𝜃 0 𝑐𝑜𝑠𝜃
1 0 0
0 𝑐𝑜𝑠𝜑 𝑠𝑖𝑛𝜑
0 −𝑠𝑖𝑛𝜑 𝑐𝑜𝑠𝜑
𝑅0
1 =
𝑐𝑜𝑠𝜃 𝑠𝑖𝑛𝜑𝑠𝑖𝑛𝜃 −𝑐𝑜𝑠𝜑𝑠𝑖𝑛𝜃
0 𝑐𝑜𝑠𝜑 𝑠𝑖𝑛𝜑
𝑠𝑖𝑛𝜃 −𝑐𝑜𝑠𝜃𝑠𝑖𝑛𝜑 𝑐𝑜𝑠𝜑𝑐𝑜𝑠𝜃
DCM
Exercise: Two Axis Gimbalx0
y0
z0
φ
θ
x1
y1
z1
Euler Rate Matrix 𝝎𝑇
0 = 𝑬 ሶ 𝜑
ሶ
𝜃
𝑬𝟏𝟐 = ො𝒆𝑿 𝑹𝑿 𝑻 ො𝒆𝒀,
𝑹𝑿 𝑻 ො𝒆𝒀 =
1 0 0
0 𝑐𝑜𝑠𝜑 𝑠𝑖𝑛𝜑
0 −𝑠𝑖𝑛𝜑 𝑐𝑜𝑠𝜑
𝑇
0
1
0
=
0
𝑐𝑜𝑠𝜑
𝑠𝑖𝑛𝜑
𝑬𝟏𝟐 =
1 0
0 𝑐𝑜𝑠𝜑
0 𝑠𝑖𝑛𝜑
Translational Kinetic Energy
• Kinetic Energy
• Potential Energy
Lecture 4:
3D Dynamics
• Translation portion straightforward
• With:
𝑇𝑡 = 1
2 𝒎 ሶ 𝒓𝑻 ሶ 𝒓
ሶ
𝒓 = 𝑑
𝑑𝑡 𝑫𝑪𝑴 𝑻𝒓𝟏
Moment of Inertia (3D)
Inertia about an arbitrary axis:
Eg. Rotation about X-axis:
Total inertia: 𝐼 =
𝐼𝑥𝑥 𝐼𝑦𝑥 𝐼𝑧𝑥
𝐼𝑦𝑥 𝐼𝑦𝑦 𝐼𝑧𝑦
𝐼𝑧𝑥 𝐼𝑦𝑧 𝐼𝑧𝑧
Off diagonals:
Total Angular Velocity
• Using the inertia: 𝑻𝒓 = 𝟏
𝟐 𝝎𝟎 𝑻𝑰𝟎𝝎𝟎
• Problem!
• Moment of Inertia wrt to 0 (inertial)
• It will change as a function of orientation as the
body rotates
• Solution?
• Define Inertia in body axis
• Will be constant as the body rotates wrt 0
Total Angular Velocity
• Using the body inertia:
𝑻𝒓 = 𝟏
𝟐 𝝎𝑩 𝑻𝑰𝑩𝝎𝑩
Constant matrix
• 𝝎𝑩 is total angular velocity of body in body axes
• Relating inertias: 𝑰𝟎 = 𝑹𝑩
𝟎 𝑰𝑩
Potential Energy
• Kinetic Energy
• Potential Energy
Lecture 4:
3D Dynamics
• Assume all gravity for now
• With:
𝑉𝑔 = 𝒎 𝒈𝟎 𝑻𝒓𝟎
𝒈𝟎 =
0
0
𝑔
Local gravitational
acceleration
Example: Acrobot
Rotation Matrices:
𝑹𝟎
𝟏 =
𝑐𝑜𝑠𝜃1 𝑠𝑖𝑛𝜃1 0
−𝑠𝑖𝑛𝜃1 𝑐𝑜𝑠𝜃1 0
0 0 1
𝑹𝟏
𝟐 =
𝑐𝑜𝑠𝜃2 𝑠𝑖𝑛𝜃2 0
−𝑠𝑖𝑛𝜃2 𝑐𝑜𝑠𝜃2 0
0 0 1
𝑹𝟎
𝟐 = 𝑹𝟏
𝟐𝑹𝟎
𝟏
Positions:
𝒓𝟎𝟏
𝟎 = 𝑹𝟎
𝟏 𝑻𝒓𝟎𝟏
𝟏 = 𝑹𝟎
𝟏 𝑻
𝐿1
2
0
0
𝒓𝟎𝟐
𝟎 = 𝑹𝟎
𝟏 𝑻 𝐿1
0
0
+ 𝑹𝟎
𝟐 𝑻𝒓𝟏𝟐
𝟐 = 𝑹𝟎
𝟏 𝑻 𝐿1
0
0
+ 𝑹𝟎
𝟐 𝑻
𝐿2
2
0
0θ1
τ2
θ2
L1
x0
y0 1
2
0
Example: Acrobot
Angular Velocity:
𝝎𝟎𝟏
𝟏 =
0
0
ሶ
𝜃1
𝝎𝟎𝟐
𝟐 = 𝑹𝟏
𝟐
0
0
ሶ
𝜃1
+
0
0
ሶ
𝜃2
𝝎𝟎𝟐
𝟐 =
0
0
ሶ
𝜃1 + ሶ 𝜃2θ1
τ2
θ2
L1
x0
y0 1
2
0
Example: Quadcopter gimbal
• Euler 3-2-1 for quad body
• Generalised coordinates?
𝒒 = 𝑥 𝑦 𝑧 𝜑1 𝜃1 𝜓1 𝜑2 𝜃2 𝑇x0
y0
z0
Exercise: Quadcopter gimbal
• Quad Angular Velocity
𝝎𝟎𝟏
𝟏 = 𝑬𝑸𝟏
′
ሶ
𝜑1
ሶ
𝜃1
ሶ
𝜓1
𝑬𝑸𝟏
′ = ො𝒆𝑿, 𝑹𝑿 ො𝒆𝒀, 𝑹𝑿𝑹𝒀 ො𝒆𝒁x0
y0
z0
Exercise: Quadcopter gimbal
• Camera Angular Velocity
𝝎𝟎𝟐
𝟐 = 𝝎𝟎𝟏
𝟐 + 𝝎𝟏𝟐
𝟐
𝑬𝑸𝟐
′ = 𝑹𝒀𝑹𝑿 ො𝒆𝑿, 𝑹𝒀𝑹𝑿𝑹𝑿 ො𝒆𝒀, 𝑹𝒀𝑹𝑿𝑹𝑿𝑹𝒀 ො𝒆𝒁
𝝎𝟎𝟏
𝟐 = 𝑬𝑸𝟐
′
ሶ
𝜑1
ሶ
𝜃1
ሶ
𝜓1x0
y0
z0
Exercise: Puma 560
• Determine Kinetic
Energy of the
gripperx0
y0
z0
• Roll(Y)→Pitch(X)→Yaw(Z)
Kinematic Chainx2
y1
z1
x0
y0
z0
z2
z3
z4
x3
x4
x1
y2
y3
y4
ψ1
φ2
φ3
φ4,θ4,ψ4
• What is 𝑹𝟎
𝟒?
𝑹𝟎
𝟒 = 𝑹𝟑
𝟒𝑹𝟐
𝟑𝑹𝟏
𝟐𝑹𝟎
𝟏
• What is 𝑹𝟑
𝟒?
𝑹𝟑
𝟒 =
𝑐𝑜𝑠𝜓4 𝑠𝑖𝑛𝜓4 0
−𝑠𝑖𝑛𝜓4 𝑐𝑜𝑠𝜓4 0
0 0 1
1 0 0
0 𝑐𝑜𝑠𝜑4 𝑠𝑖𝑛𝜑4
0 −𝑠𝑖𝑛𝜑4 𝑐𝑜𝑠𝜑4
𝑐𝑜𝑠𝜃4 0 −𝑠𝑖𝑛𝜃4
0 1 0
𝑠𝑖𝑛𝜃4 0 𝑐𝑜𝑠𝜃4
YXZ
Angular Velocity
• What is 𝝎𝟎𝟒
𝟒 ?x2
y1
z1
x0
y0
z0
z2
z3
z4
x3
x4
x1
y2
y3
y4
ψ1
φ2
φ3
φ4,θ4,ψ4
𝝎𝟎𝟒
𝟒 = 𝝎𝟎𝟏
𝟒 + 𝝎𝟏𝟐
𝟒 + 𝝎𝟐𝟑
𝟒 + 𝝎𝟑𝟒
𝟒
𝝎𝟎𝟏
𝟒 = 𝑬𝟏
′ ሶ 𝜓1,
𝑬𝟏
′ = 𝑹𝒁𝑹𝑿𝑹𝒀𝑹𝟐
𝟑𝑹𝟏
𝟐 ො𝒆𝒁
𝑹𝟑
𝟒
𝑬𝟐
′ = 𝑹𝒁𝑹𝑿𝑹𝒀𝑹𝟐
𝟑 ො𝒆𝑿 𝑬𝟑
′ = 𝑹𝒁𝑹𝑿𝑹𝒀 ො𝒆𝑿
𝝎𝟏𝟐
𝟒 = 𝑬𝟐
′ ሶ 𝜑2, 𝝎𝟐𝟑
𝟒 = 𝑬𝟑
′ ሶ 𝜑3, 𝝎𝟑𝟒
𝟒 = 𝑬𝟒
′
ሶ
𝜑4
ሶ
𝜃4
ሶ
𝜓4
Easier way?
𝑹𝟎
𝟒 𝝎𝟎𝟒
𝟒
• It would be great if we could just use the final rotation
matrix: Some magic
• We can!
Skew Symmetric Property
• R. M. Murray, Z. Li, and S. S. Sastry, A Mathematical
Introduction to Robotic Manipulation. CRC Press, 1994.
(Chapter 4.1)
𝝎𝑩 × = 𝑹𝑩
𝑰 𝑻 ሶ 𝑹𝑩
𝑰 = 𝑺
𝝎𝑩 × =
0 −𝜔3 𝜔2
𝜔3 0 −𝜔1
−𝜔2 𝜔1 0
The end.
• Next lecture:
• Generalised
forces